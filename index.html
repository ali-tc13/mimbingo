<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>NFC Colour Hunt</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root {
      --card-bg: rgba(255, 255, 255, 0.92);
      --card-border: rgba(255, 255, 255, 0.3);
      --text-main: #212121;
      --text-muted: #555;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      color: var(--text-main);
      background: radial-gradient(circle at top, #e0e0e0, #9e9e9e);
      transition: background 0.3s ease;
    }

    /* Backgrounds per colour */
    body.bg-red {
      background: radial-gradient(circle at top, #ff8a80, #c62828);
    }
    body.bg-blue {
      background: radial-gradient(circle at top, #82b1ff, #1565c0);
    }
    body.bg-green {
      background: radial-gradient(circle at top, #a5d6a7, #2e7d32);
    }
    body.bg-yellow {
      background: radial-gradient(circle at top, #ffe082, #f9a825);
    }

    .card {
      width: 100%;
      max-width: 420px;
      background: var(--card-bg);
      border-radius: 16px;
      padding: 20px 18px 18px;
      box-shadow: 0 14px 30px rgba(0,0,0,0.22);
      border: 1px solid var(--card-border);
      backdrop-filter: blur(8px);
    }

    h1 {
      margin: 0 0 4px;
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      gap: 0.4em;
    }

    h1 span.emoji {
      font-size: 1.6rem;
    }

    .subtitle {
      margin: 0 0 12px;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .banner {
      padding: 10px 12px;
      border-radius: 10px;
      margin-bottom: 14px;
      background: rgba(255,255,255,0.8);
      border: 1px solid rgba(0,0,0,0.04);
      font-size: 0.95rem;
    }

    h2 {
      margin: 10px 0 6px;
      font-size: 1.05rem;
    }

    #progress {
      margin: 0 0 8px;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.08);
      font-size: 0.85rem;
      background: rgba(255,255,255,0.9);
    }

    .colour-swatch {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 6px;
      border: 1px solid rgba(0,0,0,0.15);
    }

    .swatch-red    { background: #e53935; }
    .swatch-blue   { background: #1e88e5; }
    .swatch-green  { background: #43a047; }
    .swatch-yellow { background: #fdd835; }

    .footer {
      margin-top: 8px;
      font-size: 0.8rem;
      color: var(--text-muted);
      text-align: right;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1><span class="emoji">ðŸŽ¨</span> NFC Colour Hunt</h1>
    <p class="subtitle">Tap tags, collect colours, finish the set.</p>

    <div id="message" class="banner">Loadingâ€¦</div>

    <h2>Your colours</h2>
    <p id="progress"></p>
    <div id="colour-list" class="chips"></div>

    <div class="footer" id="footer-note"></div>
  </div>

  <script>
    (function() {
      // Colours in the game
      var ALL_COLOURS = ['red', 'blue', 'green', 'yellow'];
      var LABELS = {
        red: 'Red',
        blue: 'Blue',
        green: 'Green',
        yellow: 'Yellow'
      };

      function getQueryParam(name) {
        var params = new URLSearchParams(window.location.search);
        return params.get(name);
      }

      function loadState() {
        try {
          var raw = localStorage.getItem('nfc_colour_hunt_state');
          if (!raw) return { colours: [] };
          var parsed = JSON.parse(raw);
          if (!parsed || !Array.isArray(parsed.colours)) return { colours: [] };
          return parsed;
        } catch (e) {
          return { colours: [] };
        }
      }

      function saveState(state) {
        try {
          localStorage.setItem('nfc_colour_hunt_state', JSON.stringify(state));
        } catch (e) { /* ignore */ }
      }

      function unique(list) {
        var s = new Set();
        list.forEach(function(x) { s.add(x); });
        return Array.from(s);
      }

      function setBodyBackgroundForColour(colour) {
        document.body.classList.remove('bg-red', 'bg-blue', 'bg-green', 'bg-yellow');
        if (colour && ALL_COLOURS.indexOf(colour) !== -1) {
          document.body.classList.add('bg-' + colour);
        }
      }

      var tag = (getQueryParam('tag') || '').toLowerCase();
      var state = loadState();

      var messageEl = document.getElementById('message');
      var progressEl = document.getElementById('progress');
      var listEl = document.getElementById('colour-list');
      var footerEl = document.getElementById('footer-note');

      if (!tag) {
        messageEl.textContent = 'Tap a colour tag to start collecting.';
      } else if (ALL_COLOURS.indexOf(tag) === -1) {
        messageEl.textContent = 'Unknown colour tag: ' + tag;
      } else {
        // change background to match colour
        setBodyBackgroundForColour(tag);

        // Add this colour to state
        state.colours.push(tag);
        state.colours = unique(state.colours);
        saveState(state);

        var label = LABELS[tag] || tag;
        messageEl.innerHTML = 'You just collected: <strong>' + label + '</strong> ðŸŽ‰';
      }

      // Build list & progress
      var collected = state.colours;
      var total = ALL_COLOURS.length;
      var count = collected.length;

      progressEl.textContent = 'You have collected ' + count + ' of ' + total + ' colours.';

      listEl.innerHTML = '';

      if (count === 0) {
        listEl.textContent = 'No colours yet â€“ go find a tag!';
      } else {
        collected.sort().forEach(function(c) {
          var chip = document.createElement('div');
          chip.className = 'chip';

          var swatch = document.createElement('span');
          swatch.className = 'colour-swatch swatch-' + c;
          chip.appendChild(swatch);

          var text = document.createTextNode(LABELS[c] || c);
          chip.appendChild(text);

          listEl.appendChild(chip);
        });
      }

      if (count === total && total > 0) {
        footerEl.textContent = 'ðŸŽ‰ You collected them all!';
      } else {
        footerEl.textContent = '';
      }

      // If there was a previous collection but no tag in URL,
      // set background to the first collected colour as a vibe
      if (!tag && collected.length > 0) {
        setBodyBackgroundForColour(collected[0]);
      }
    })();
  </script>
</body>
</html>
